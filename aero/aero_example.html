
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Aerodynamic Wing Optimization Design Problem &#8212; TTT Garage</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Aerostructural wing optimization using OpenAeroStruct" href="../aerostructural/aerostructural_example.html" />
    <link rel="prev" title="Welcome to the TTT Garage!" href="../intro.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/TTT_garage.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">TTT Garage</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Welcome to the TTT Garage!
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Aerodynamic Wing Optimization Design Problem
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../aerostructural/aerostructural_example.html">
   Aerostructural wing optimization using OpenAeroStruct
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../battery/battery_example.html">
   Battery pack thermal modeling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../rotor_aero/rotor_aero_example.html">
   Aerodynamics Rotor Optimization with CCBlade
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../trajectory/trajectory_example.html">
   Trajectory optimization of a commercial airliner
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/docs/aero/aero_example.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/executablebooks/jupyter-book"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Faero/aero_example.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/aero/aero_example.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#brief-overview-of-the-problem">
   Brief overview of the problem
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tools-used-in-this-example">
   Tools used in this example
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#run-script-and-explanation">
   Run script and explanation
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Aerodynamic Wing Optimization Design Problem</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#brief-overview-of-the-problem">
   Brief overview of the problem
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tools-used-in-this-example">
   Tools used in this example
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#run-script-and-explanation">
   Run script and explanation
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="aerodynamic-wing-optimization-design-problem">
<h1>Aerodynamic Wing Optimization Design Problem<a class="headerlink" href="#aerodynamic-wing-optimization-design-problem" title="Permalink to this headline">#</a></h1>
<p><img alt="VSPAero wing" src="../_images/rect_wing.png" /></p>
<section id="brief-overview-of-the-problem">
<h2>Brief overview of the problem<a class="headerlink" href="#brief-overview-of-the-problem" title="Permalink to this headline">#</a></h2>
<p>The aerodynamic wing optimization design problem involves optimizing the shape of a rectangular wing to minimize drag and achieve a specific lift coefficient. The problem uses an open-source software package called <a class="reference external" href="https://openmdao.org/">OpenMDAO</a> to create a multi-disciplinary optimization framework that combines aerodynamics, structural mechanics, and geometric design.</p>
<p>The optimization problem takes as input several design parameters such as the chord and span of the wing, and the angle of attack, and uses an aerodynamic solver to compute the lift and drag coefficients of the wing at a specific flight condition. The solver is based on a Vortex Lattice Method (VLM) that approximates the aerodynamics of the wing using a discrete set of vortices.</p>
<p>The optimization algorithm then adjusts the design parameters to find the set of parameters that minimizes the drag of the wing while achieving a specific lift coefficient. The algorithm uses the <a class="reference external" href="http://www.sbsi-sol-optimize.com/asp/sol_product_snopt.htm">SNOPT optimization solver</a> to find the optimal solution.</p>
<p>The problem can be modified to explore different design objectives, such as optimizing for both lift and stability, or to include additional disciplines such as structural optimization or uncertainty quantification. The example provides a starting point for engineers and scientists to use open-source software and computational methods to optimize the design of a wing and improve its performance.</p>
</section>
<section id="tools-used-in-this-example">
<h2>Tools used in this example<a class="headerlink" href="#tools-used-in-this-example" title="Permalink to this headline">#</a></h2>
<p>This code example demonstrates the use of several tools commonly used in aerospace engineering design and analysis: OpenMDAO, OpenVSP, and VSPAero.</p>
<p><a class="reference external" href="https://openmdao.org/">OpenMDAO</a> is an open-source software framework for multidisciplinary design optimization (MDO) of complex systems. It provides a framework for building and solving optimization problems with a modular approach. It allows for the integration of different disciplines and optimization algorithms, making it a valuable tool for aerospace engineering design problems that often require the consideration of multiple disciplines.</p>
<p><a class="reference external" href="https://openvsp.org/">OpenVSP</a> is an open-source parametric aircraft geometry tool used to create 3D models of aircraft. It allows for the creation of complex geometry models and provides tools for analysis and optimization. OpenVSP was used in this example to create the geometry of a rectangular wing.</p>
<p><a class="reference external" href="https://github.com/OpenMDAO/VSPAERO">VSPAero</a> is an aerodynamic analysis tool that works with OpenVSP to provide aerodynamic analysis and optimization capabilities. VSPAero uses the Vortex Lattice Method (VLM) to compute the aerodynamic forces and moments on the aircraft. In this example, VSPAero was used to perform an aerodynamic analysis of the rectangular wing created in OpenVSP. The analysis was performed for a specific flight condition defined by the angle of attack and wing area.</p>
<p>The use of these tools in this example demonstrates a typical workflow in aerospace engineering design and analysis. OpenVSP is used to create the aircraft geometry, which is then analyzed using VSPAero. OpenMDAO is used to integrate the aerodynamic analysis results into an optimization problem to find the optimal design of the aircraft under certain constraints. This workflow enables engineers to explore the design space and find optimal solutions that meet the given design requirements.</p>
</section>
<section id="run-script-and-explanation">
<h2>Run script and explanation<a class="headerlink" href="#run-script-and-explanation" title="Permalink to this headline">#</a></h2>
<p>This code block defines an OpenMDAO component called FlightCase, which sets up and solves an aerodynamic analysis problem using the vortex lattice method (VLM) for a given aircraft design, specified using OpenVSP.</p>
<p>The component first initializes the VLM assembler pyVSPAero with the provided VSP model file. The VLM assembler sets up the simulation and provides the necessary functions to compute aerodynamic coefficients CL and CD. These functions are added as outputs to the component.</p>
<p>In the setup method, the component sets up its inputs, which include the angle of attack aoa, reference area S_ref, and the initial aircraft geometry x_aero. It also sets up the outputs for the aerodynamic coefficients. Additionally, the component sets up the VLMAssembler object by creating a steady problem instance with the specified name and options.</p>
<p>The compute method of the component sets the flight variables and geometry using the inputs, solves the VLM problem, and evaluates the output functions to get the values of the aerodynamic coefficients. These coefficients are assigned to the component’s outputs.</p>
<p>The compute_partials method computes the partial derivatives of the output functions with respect to the input variables. These partial derivatives are used in the gradient-based optimization algorithm to find the optimal design.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">openmdao.api</span> <span class="k">as</span> <span class="nn">om</span>
<span class="kn">from</span> <span class="nn">pygeo.mphys</span> <span class="kn">import</span> <span class="n">OM_DVGEOCOMP</span>
<span class="kn">import</span> <span class="nn">openvsp</span>

<span class="kn">from</span> <span class="nn">vspaero.pyvspaero</span> <span class="kn">import</span> <span class="n">pyVSPAero</span>
<span class="kn">from</span> <span class="nn">vspaero</span> <span class="kn">import</span> <span class="n">functions</span>


<span class="k">class</span> <span class="nc">FlightCase</span><span class="p">(</span><span class="n">om</span><span class="o">.</span><span class="n">ExplicitComponent</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">declare</span><span class="p">(</span><span class="s2">&quot;vsp_file&quot;</span><span class="p">,</span> <span class="n">recordable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># VSP model</span>
        <span class="n">vsp_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;vsp_file&quot;</span><span class="p">]</span>

        <span class="n">VLMAssembler</span> <span class="o">=</span> <span class="n">pyVSPAero</span><span class="p">(</span><span class="n">vsp_file</span><span class="p">)</span>
        <span class="c1"># Add output functions</span>
        <span class="n">VLMAssembler</span><span class="o">.</span><span class="n">add_function</span><span class="p">(</span><span class="s2">&quot;CL&quot;</span><span class="p">,</span> <span class="n">functions</span><span class="o">.</span><span class="n">CLi</span><span class="p">)</span>
        <span class="n">VLMAssembler</span><span class="o">.</span><span class="n">add_function</span><span class="p">(</span><span class="s2">&quot;CD&quot;</span><span class="p">,</span> <span class="n">functions</span><span class="o">.</span><span class="n">CDi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assembler</span> <span class="o">=</span> <span class="n">VLMAssembler</span>

        <span class="c1"># Create a steady problem instance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">problem</span> <span class="o">=</span> <span class="n">VLMAssembler</span><span class="o">.</span><span class="n">create_steady_problem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;symmetry&quot;</span><span class="p">:</span> <span class="s2">&quot;Y&quot;</span><span class="p">})</span>

        <span class="n">mesh_xyz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">get_geometry</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="s2">&quot;aoa&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="s2">&quot;S_ref&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="s2">&quot;x_aero&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">mesh_xyz</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">mesh_xyz</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">out_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">func_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="n">out_name</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">declare_partials</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">get_geometry</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">set_flight_vars</span><span class="p">(</span><span class="o">**</span><span class="n">inputs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">set_geometry</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;x_aero&quot;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>

        <span class="n">funcs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">eval_functions</span><span class="p">(</span><span class="n">funcs</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">out_name</span> <span class="ow">in</span> <span class="n">outputs</span><span class="p">:</span>
            <span class="n">output_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">out_name</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">outputs</span><span class="p">[</span><span class="n">out_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">funcs</span><span class="p">[</span><span class="n">output_key</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">write_solution</span><span class="p">(</span><span class="n">output_dir</span><span class="o">=</span><span class="s2">&quot;./output&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">compute_partials</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">J</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Jacobian of partial derivatives.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">set_flight_vars</span><span class="p">(</span><span class="o">**</span><span class="n">inputs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">set_geometry</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;x_aero&quot;</span><span class="p">])</span>

        <span class="n">funcs_sens</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">eval_functions_sens</span><span class="p">(</span><span class="n">funcs_sens</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">out_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">func_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">in_name</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">:</span>
                <span class="n">output_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">out_name</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">if</span> <span class="n">in_name</span> <span class="o">==</span> <span class="s2">&quot;x_aero&quot;</span><span class="p">:</span>
                    <span class="n">J</span><span class="p">[</span><span class="n">out_name</span><span class="p">,</span> <span class="n">in_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">funcs_sens</span><span class="p">[</span><span class="n">output_key</span><span class="p">][</span><span class="s2">&quot;xyz&quot;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">J</span><span class="p">[</span><span class="n">out_name</span><span class="p">,</span> <span class="n">in_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">funcs_sens</span><span class="p">[</span><span class="n">output_key</span><span class="p">][</span><span class="n">in_name</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>The Planform class is an ExplicitComponent that calculates the reference wing area (S_ref) of a VSP model. S_ref is the reference area used to calculate lift and drag forces. The class takes WingGeom parameters (root chord and tip chord for each section of the wing) as inputs and returns the reference area as output. The reference wing area is calculated using the openvsp package, which is used to read and write VSP files. The compute function takes the inputs dictionary containing the WingGeom parameters as inputs, updates the VSP model with the new values, calculates the reference area using GetParmVal function from openvsp, and sets the reference area as the output of the component.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Planform</span><span class="p">(</span><span class="n">om</span><span class="o">.</span><span class="n">ExplicitComponent</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">declare</span><span class="p">(</span><span class="s2">&quot;vsp_file&quot;</span><span class="p">,</span> <span class="n">recordable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># VSP model</span>
        <span class="n">vsp_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;vsp_file&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="s2">&quot;WingGeom:XSec_1:Root_Chord&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="s2">&quot;WingGeom:XSec_2:Root_Chord&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="s2">&quot;WingGeom:XSec_3:Root_Chord&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="s2">&quot;WingGeom:XSec_4:Root_Chord&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="s2">&quot;WingGeom:XSec_4:Tip_Chord&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s2">&quot;S_ref&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">declare_partials</span><span class="p">(</span><span class="s2">&quot;S_ref&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;fd&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vsp_model</span> <span class="o">=</span> <span class="n">openvsp</span><span class="o">.</span><span class="n">VSPVehicle</span><span class="p">(</span><span class="n">vsp_file</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">input_key</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="n">input_key</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">geom_name</span><span class="p">,</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">parm_name</span> <span class="o">=</span> <span class="n">input_key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
            <span class="n">container_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vsp_model</span><span class="o">.</span><span class="n">FindContainer</span><span class="p">(</span><span class="n">geom_name</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vsp_model</span><span class="o">.</span><span class="n">SetParmValUpdate</span><span class="p">(</span><span class="n">container_id</span><span class="p">,</span> <span class="n">parm_name</span><span class="p">,</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vsp_model</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span>
        <span class="n">parm_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vsp_model</span><span class="o">.</span><span class="n">FindParm</span><span class="p">(</span><span class="n">container_id</span><span class="p">,</span> <span class="s2">&quot;TotalArea&quot;</span><span class="p">,</span> <span class="n">geom_name</span><span class="p">)</span>
        <span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;S_ref&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vsp_model</span><span class="o">.</span><span class="n">GetParmVal</span><span class="p">(</span><span class="n">parm_id</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Top is an om.Group object that is used to collect and manage several components of the optimization problem.</p>
<p>The setup method of Top is used to set up the optimization problem. It adds several subsystems to the problem:</p>
<p>An initial_mesh subsystem that initializes the mesh.
A geometry subsystem that adds geometry to the problem.
A planform subsystem that calculates the planform.
A cruise subsystem that calculates the cruise performance.
The initial_mesh and geometry subsystems set up the geometry of the problem using OM_DVGEOCOMP and a vsp_file. geometry adds a pointset to the geometry called “aero” that will be used in the cruise analysis.</p>
<p>The planform subsystem calculates the planform of the problem. It sets up design variables for the root and tip chord lengths for each of the four wing sections, and computes the wing reference area.</p>
<p>The cruise subsystem calculates the performance of the wing in cruise mode using FlightCase which sets up the VLM model and computes the CL and CD.</p>
<p>The optimization problem is then set up by creating an instance of om.Problem(), adding the Top() group to the problem, setting up the driver as om.pyOptSparseDriver, and adding the design variables, constraints, and objective.</p>
<p>The problem is then run by calling prob.run_driver() and the results are printed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Top</span><span class="p">(</span><span class="n">om</span><span class="o">.</span><span class="n">Group</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="c1"># Setup VLM assembler</span>
        <span class="n">vsp_file</span> <span class="o">=</span> <span class="s2">&quot;rect_wing.vsp3&quot;</span>
        <span class="n">cruise_component</span> <span class="o">=</span> <span class="n">FlightCase</span><span class="p">(</span><span class="n">vsp_file</span><span class="o">=</span><span class="n">vsp_file</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span><span class="s2">&quot;initial_mesh&quot;</span><span class="p">,</span> <span class="n">om</span><span class="o">.</span><span class="n">IndepVarComp</span><span class="p">())</span>

        <span class="c1"># add the geometry component, we dont need a builder because we do it here.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span> <span class="n">OM_DVGEOCOMP</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">vsp_file</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;vsp&quot;</span><span class="p">),</span> <span class="n">promotes_inputs</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;WingGeom*&quot;</span><span class="p">])</span>
        <span class="c1"># add pointset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">nom_add_discipline_coords</span><span class="p">(</span><span class="s2">&quot;aero&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span><span class="s2">&quot;planform&quot;</span><span class="p">,</span> <span class="n">Planform</span><span class="p">(</span><span class="n">vsp_file</span><span class="o">=</span><span class="n">vsp_file</span><span class="p">),</span> <span class="n">promotes_inputs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;planform.S_ref&quot;</span><span class="p">,</span> <span class="s2">&quot;cruise.S_ref&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span><span class="s2">&quot;cruise&quot;</span><span class="p">,</span> <span class="n">cruise_component</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;geometry.x_aero0&quot;</span><span class="p">,</span> <span class="s2">&quot;cruise.x_aero&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_mesh</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s2">&quot;x_aero0&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cruise</span><span class="o">.</span><span class="n">get_mesh</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;initial_mesh.x_aero0&quot;</span><span class="p">,</span> <span class="s2">&quot;geometry.x_aero_in&quot;</span><span class="p">)</span>

        <span class="c1"># create geometric DV setup</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">nom_addVSPVariable</span><span class="p">(</span><span class="s2">&quot;WingGeom&quot;</span><span class="p">,</span> <span class="s2">&quot;XSec_1&quot;</span><span class="p">,</span> <span class="s2">&quot;Root_Chord&quot;</span><span class="p">,</span> <span class="n">scaledStep</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">nom_addVSPVariable</span><span class="p">(</span><span class="s2">&quot;WingGeom&quot;</span><span class="p">,</span> <span class="s2">&quot;XSec_2&quot;</span><span class="p">,</span> <span class="s2">&quot;Root_Chord&quot;</span><span class="p">,</span> <span class="n">scaledStep</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">nom_addVSPVariable</span><span class="p">(</span><span class="s2">&quot;WingGeom&quot;</span><span class="p">,</span> <span class="s2">&quot;XSec_3&quot;</span><span class="p">,</span> <span class="s2">&quot;Root_Chord&quot;</span><span class="p">,</span> <span class="n">scaledStep</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">nom_addVSPVariable</span><span class="p">(</span><span class="s2">&quot;WingGeom&quot;</span><span class="p">,</span> <span class="s2">&quot;XSec_4&quot;</span><span class="p">,</span> <span class="s2">&quot;Root_Chord&quot;</span><span class="p">,</span> <span class="n">scaledStep</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">nom_addVSPVariable</span><span class="p">(</span><span class="s2">&quot;WingGeom&quot;</span><span class="p">,</span> <span class="s2">&quot;XSec_4&quot;</span><span class="p">,</span> <span class="s2">&quot;Tip_Chord&quot;</span><span class="p">,</span> <span class="n">scaledStep</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">prob</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">Problem</span><span class="p">()</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">Top</span><span class="p">()</span>

<span class="c1"># Set optimizer as model driver</span>
<span class="n">prob</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">pyOptSparseDriver</span><span class="p">(</span><span class="n">debug_print</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;objs&#39;</span><span class="p">,</span> <span class="s1">&#39;nl_cons&#39;</span><span class="p">,</span> <span class="s2">&quot;desvars&quot;</span><span class="p">])</span>
<span class="n">prob</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;optimizer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;SNOPT&quot;</span>
<span class="n">prob</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">opt_settings</span><span class="p">[</span><span class="s1">&#39;Major iterations limit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">prob</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">opt_settings</span><span class="p">[</span><span class="s2">&quot;Nonderivative linesearch&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">prob</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">opt_settings</span><span class="p">[</span><span class="s2">&quot;Major optimality tolerance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-4</span>
<span class="n">prob</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">opt_settings</span><span class="p">[</span><span class="s2">&quot;Major feasibility tolerance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-5</span>
<span class="n">prob</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">opt_settings</span><span class="p">[</span><span class="s2">&quot;Hessian updates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>


<span class="c1"># Setup problem and add design variables, constraint, and objective</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_design_var</span><span class="p">(</span><span class="s2">&quot;WingGeom:XSec_1:Root_Chord&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_design_var</span><span class="p">(</span><span class="s2">&quot;WingGeom:XSec_2:Root_Chord&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_design_var</span><span class="p">(</span><span class="s2">&quot;WingGeom:XSec_3:Root_Chord&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_design_var</span><span class="p">(</span><span class="s2">&quot;WingGeom:XSec_4:Root_Chord&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_design_var</span><span class="p">(</span><span class="s2">&quot;WingGeom:XSec_4:Tip_Chord&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_design_var</span><span class="p">(</span><span class="s2">&quot;cruise.aoa&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=-</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="s2">&quot;cruise.CL&quot;</span><span class="p">,</span> <span class="n">equals</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="s2">&quot;planform.S_ref&quot;</span><span class="p">,</span> <span class="n">equals</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">scaler</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_objective</span><span class="p">(</span><span class="s2">&quot;cruise.CD&quot;</span><span class="p">,</span> <span class="n">scaler</span><span class="o">=</span><span class="mf">1e4</span><span class="p">)</span>

<span class="n">prob</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>

<span class="n">prob</span><span class="o">.</span><span class="n">run_model</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CL&quot;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s2">&quot;cruise.CL&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CD&quot;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s2">&quot;cruise.CD&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

<span class="n">prob</span><span class="o">.</span><span class="n">run_driver</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Initializing DVGeometryVSP
Loading the vsp model took: 0.025979995727539062
Building a quad mesh for fast projections.
Initialized DVGeometry VSP in 0.030251502990722656 seconds.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DVGeometryVSP note:
Adding pointset x_aero0 took 0.003663778305053711 seconds.
Maximum distance between the added points and the VSP geometry is 3.731756137924373e-12
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CL 0.4299103947134961
CD 0.005992091473352067
Driver debug print for iter coord: rank0:pyOptSparse_SNOPT|0
------------------------------------------------------------
Design Vars
{&#39;WingGeom:XSec_1:Root_Chord&#39;: array([1.]),
 &#39;WingGeom:XSec_2:Root_Chord&#39;: array([1.]),
 &#39;WingGeom:XSec_3:Root_Chord&#39;: array([1.]),
 &#39;WingGeom:XSec_4:Root_Chord&#39;: array([1.]),
 &#39;WingGeom:XSec_4:Tip_Chord&#39;: array([1.]),
 &#39;cruise.aoa&#39;: array([5.])}
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Nonlinear constraints
{&#39;cruise.CL&#39;: array([0.42991039]), &#39;planform.S_ref&#39;: array([10.])}

Objectives
{&#39;cruise.CD&#39;: array([0.00599209])}
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>FD jacobian calcs with dvgeovsp took 0.1570589542388916 seconds in total
updating the vsp model took 0.11221575736999512 seconds
evaluating the new points took 0.0030431747436523438 seconds
communication took 0.00026035308837890625 seconds
Driver debug print for iter coord: rank0:pyOptSparse_SNOPT|1
------------------------------------------------------------
Design Vars
{&#39;WingGeom:XSec_1:Root_Chord&#39;: array([1.000001]),
 &#39;WingGeom:XSec_2:Root_Chord&#39;: array([0.999999]),
 &#39;WingGeom:XSec_3:Root_Chord&#39;: array([1.000001]),
 &#39;WingGeom:XSec_4:Root_Chord&#39;: array([0.999999]),
 &#39;WingGeom:XSec_4:Tip_Chord&#39;: array([1.000001]),
 &#39;cruise.aoa&#39;: array([4.999999])}
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Nonlinear constraints
{&#39;cruise.CL&#39;: array([0.42991031]), &#39;planform.S_ref&#39;: array([10.])}

Objectives
{&#39;cruise.CD&#39;: array([0.00599209])}
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Driver debug print for iter coord: rank0:pyOptSparse_SNOPT|2
------------------------------------------------------------
Design Vars
{&#39;WingGeom:XSec_1:Root_Chord&#39;: array([1.1923384]),
 &#39;WingGeom:XSec_2:Root_Chord&#39;: array([1.33584493]),
 &#39;WingGeom:XSec_3:Root_Chord&#39;: array([1.05943977]),
 &#39;WingGeom:XSec_4:Root_Chord&#39;: array([0.62993406]),
 &#39;WingGeom:XSec_4:Tip_Chord&#39;: array([0.7572241]),
 &#39;cruise.aoa&#39;: array([5.58510832])}
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Nonlinear constraints
{&#39;cruise.CL&#39;: array([0.48846365]), &#39;planform.S_ref&#39;: array([10.])}

Objectives
{&#39;cruise.CD&#39;: array([0.00755966])}
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>FD jacobian calcs with dvgeovsp took 0.2277379035949707 seconds in total
updating the vsp model took 0.18096256256103516 seconds
evaluating the new points took 0.0029103755950927734 seconds
communication took 0.0002155303955078125 seconds
Driver debug print for iter coord: rank0:pyOptSparse_SNOPT|3
------------------------------------------------------------
Design Vars
{&#39;WingGeom:XSec_1:Root_Chord&#39;: array([0.89473097]),
 &#39;WingGeom:XSec_2:Root_Chord&#39;: array([0.76437145]),
 &#39;WingGeom:XSec_3:Root_Chord&#39;: array([1.25764842]),
 &#39;WingGeom:XSec_4:Root_Chord&#39;: array([1.21193095]),
 &#39;WingGeom:XSec_4:Tip_Chord&#39;: array([0.63736741]),
 &#39;cruise.aoa&#39;: array([5.49025158])}
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Nonlinear constraints
{&#39;cruise.CL&#39;: array([0.4660347]), &#39;planform.S_ref&#39;: array([10.])}

Objectives
{&#39;cruise.CD&#39;: array([0.00736325])}
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Driver debug print for iter coord: rank0:pyOptSparse_SNOPT|4
------------------------------------------------------------
Design Vars
{&#39;WingGeom:XSec_1:Root_Chord&#39;: array([1.08683471]),
 &#39;WingGeom:XSec_2:Root_Chord&#39;: array([1.133254]),
 &#39;WingGeom:XSec_3:Root_Chord&#39;: array([1.12970597]),
 &#39;WingGeom:XSec_4:Root_Chord&#39;: array([0.83625559]),
 &#39;WingGeom:XSec_4:Tip_Chord&#39;: array([0.71473415]),
 &#39;cruise.aoa&#39;: array([5.55148102])}
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Nonlinear constraints
{&#39;cruise.CL&#39;: array([0.48818426]), &#39;planform.S_ref&#39;: array([10.])}

Objectives
{&#39;cruise.CD&#39;: array([0.00750284])}
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>FD jacobian calcs with dvgeovsp took 0.23507070541381836 seconds in total
updating the vsp model took 0.1878817081451416 seconds
evaluating the new points took 0.002986431121826172 seconds
communication took 0.0002474784851074219 seconds
Driver debug print for iter coord: rank0:pyOptSparse_SNOPT|5
------------------------------------------------------------
Design Vars
{&#39;WingGeom:XSec_1:Root_Chord&#39;: array([1.14009194]),
 &#39;WingGeom:XSec_2:Root_Chord&#39;: array([1.1842854]),
 &#39;WingGeom:XSec_3:Root_Chord&#39;: array([1.13326328]),
 &#39;WingGeom:XSec_4:Root_Chord&#39;: array([0.78303945]),
 &#39;WingGeom:XSec_4:Tip_Chord&#39;: array([0.6587318]),
 &#39;cruise.aoa&#39;: array([5.66413494])}
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Nonlinear constraints
{&#39;cruise.CL&#39;: array([0.48818426]), &#39;planform.S_ref&#39;: array([10.])}

Objectives
{&#39;cruise.CD&#39;: array([0.00750284])}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>capi_return is NULL
Call-back cb_userfg_in_snoptc__user__routines failed.
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">line</span> <span class="mi">62</span>
<span class="g g-Whitespace">     </span><span class="mi">59</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CL&quot;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s2">&quot;cruise.CL&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<span class="g g-Whitespace">     </span><span class="mi">60</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CD&quot;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s2">&quot;cruise.CD&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<span class="ne">---&gt; </span><span class="mi">62</span> <span class="n">prob</span><span class="o">.</span><span class="n">run_driver</span><span class="p">()</span>

<span class="nn">File /mnt/c/Users/John/Dropbox/git/openmdao/openmdao/utils/hooks.py:131,</span> in <span class="ni">_hook_decorator.&lt;locals&gt;.execute_hooks</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">129</span> <span class="k">def</span> <span class="nf">execute_hooks</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">130</span>     <span class="n">_run_hooks</span><span class="p">(</span><span class="n">pre_hooks</span><span class="p">,</span> <span class="n">inst</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">131</span>     <span class="n">ret</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">132</span>     <span class="n">_run_hooks</span><span class="p">(</span><span class="n">post_hooks</span><span class="p">,</span> <span class="n">inst</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">133</span>     <span class="k">return</span> <span class="n">ret</span>

<span class="nn">File /mnt/c/Users/John/Dropbox/git/openmdao/openmdao/core/problem.py:680,</span> in <span class="ni">Problem.run_driver</span><span class="nt">(self, case_prefix, reset_iter_counts)</span>
<span class="g g-Whitespace">    </span><span class="mi">677</span>     <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_clear_iprint</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">679</span>     <span class="k">with</span> <span class="n">SaveOptResult</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">680</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">681</span> <span class="k">finally</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">682</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_recording_iter</span><span class="o">.</span><span class="n">prefix</span> <span class="o">=</span> <span class="n">old_prefix</span>

<span class="nn">File /mnt/c/Users/John/Dropbox/git/openmdao/openmdao/drivers/pyoptsparse_driver.py:551,</span> in <span class="ni">pyOptSparseDriver.run</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">547</span>             <span class="bp">self</span><span class="o">.</span><span class="n">_exc_info</span> <span class="o">=</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">548</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">549</span> 
<span class="g g-Whitespace">    </span><span class="mi">550</span>         <span class="c1"># Use OpenMDAO&#39;s differentiator for the gradient</span>
<span class="ne">--&gt; </span><span class="mi">551</span>         <span class="n">sol</span> <span class="o">=</span> <span class="n">opt</span><span class="p">(</span><span class="n">opt_prob</span><span class="p">,</span> <span class="n">sens</span><span class="o">=</span><span class="n">WeakMethodWrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_gradfunc&#39;</span><span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">552</span>                   <span class="n">storeHistory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hist_file</span><span class="p">,</span> <span class="n">hotStart</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hotstart_file</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">554</span> <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">555</span>     <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exc_info</span><span class="p">:</span>

<span class="nn">File ~/anaconda3/envs/dev/lib/python3.8/site-packages/pyoptsparse/pySNOPT/pySNOPT.py:486,</span> in <span class="ni">SNOPT.__call__</span><span class="nt">(self, optProb, sens, sensStep, sensMode, storeHistory, hotStart, storeSens, timeLimit, restartDict)</span>
<span class="g g-Whitespace">    </span><span class="mi">484</span> <span class="n">timeA</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">485</span> <span class="c1"># fmt: off</span>
<span class="ne">--&gt; </span><span class="mi">486</span> <span class="n">hs</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">rc</span><span class="p">,</span> <span class="n">inform</span><span class="p">,</span> <span class="n">mincw</span><span class="p">,</span> <span class="n">miniw</span><span class="p">,</span> <span class="n">minrw</span><span class="p">,</span> <span class="n">nS</span><span class="p">,</span> <span class="n">ninf</span><span class="p">,</span> <span class="n">sinf</span><span class="p">,</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">snopt</span><span class="o">.</span><span class="n">snkerc</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">487</span>     <span class="n">start</span><span class="p">,</span> <span class="n">nnCon</span><span class="p">,</span> <span class="n">nnObj</span><span class="p">,</span> <span class="n">nnJac</span><span class="p">,</span> <span class="n">iObj</span><span class="p">,</span> <span class="n">ObjAdd</span><span class="p">,</span> <span class="n">ProbNm</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">488</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_userfg_wrap</span><span class="p">,</span> <span class="n">snopt</span><span class="o">.</span><span class="n">snlog</span><span class="p">,</span> <span class="n">snopt</span><span class="o">.</span><span class="n">snlog2</span><span class="p">,</span> <span class="n">snopt</span><span class="o">.</span><span class="n">sqlog</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_snstop</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">489</span>     <span class="n">Acol</span><span class="p">,</span> <span class="n">indA</span><span class="p">,</span> <span class="n">locA</span><span class="p">,</span> <span class="n">bl</span><span class="p">,</span> <span class="n">bu</span><span class="p">,</span> <span class="n">Names</span><span class="p">,</span> <span class="n">hs</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">cu</span><span class="p">,</span> <span class="n">iu</span><span class="p">,</span> <span class="n">ru</span><span class="p">,</span> <span class="n">cw</span><span class="p">,</span> <span class="n">iw</span><span class="p">,</span> <span class="n">rw</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">490</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">491</span> <span class="c1"># fmt: on</span>
<span class="g g-Whitespace">    </span><span class="mi">492</span> <span class="n">optTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">timeA</span>

<span class="nn">File ~/anaconda3/envs/dev/lib/python3.8/site-packages/pyoptsparse/pySNOPT/pySNOPT.py:559,</span> in <span class="ni">SNOPT._userfg_wrap</span><span class="nt">(self, mode, nnJac, x, fobj, gobj, fcon, gcon, nState, cu, iu, ru)</span>
<span class="g g-Whitespace">    </span><span class="mi">557</span> <span class="n">fail</span> <span class="o">=</span> <span class="mi">0</span>
<span class="g g-Whitespace">    </span><span class="mi">558</span> <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">559</span>     <span class="n">fobj</span><span class="p">,</span> <span class="n">fcon</span><span class="p">,</span> <span class="n">fail</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_masterFunc</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;fobj&quot;</span><span class="p">,</span> <span class="s2">&quot;fcon&quot;</span><span class="p">])</span>
<span class="g g-Whitespace">    </span><span class="mi">560</span> <span class="k">if</span> <span class="n">fail</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">561</span>     <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>

<span class="nn">File ~/anaconda3/envs/dev/lib/python3.8/site-packages/pyoptsparse/pyOpt_optimizer.py:321,</span> in <span class="ni">Optimizer._masterFunc</span><span class="nt">(self, x, evaluate)</span>
<span class="g g-Whitespace">    </span><span class="mi">318</span> <span class="c1"># Now broadcast out the required arguments:</span>
<span class="g g-Whitespace">    </span><span class="mi">319</span> <span class="bp">self</span><span class="o">.</span><span class="n">optProb</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">bcast</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">321</span> <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_masterFunc2</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">322</span> <span class="bp">self</span><span class="o">.</span><span class="n">interfaceTime</span> <span class="o">+=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">timeA</span>
<span class="g g-Whitespace">    </span><span class="mi">323</span> <span class="k">return</span> <span class="n">result</span>

<span class="nn">File ~/anaconda3/envs/dev/lib/python3.8/site-packages/pyoptsparse/pyOpt_optimizer.py:355,</span> in <span class="ni">Optimizer._masterFunc2</span><span class="nt">(self, x, evaluate, writeHist)</span>
<span class="g g-Whitespace">    </span><span class="mi">350</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">atol</span><span class="o">=</span><span class="n">EPS</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="n">EPS</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;funcs&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">351</span>     <span class="c1"># The previous evaluated point is different than the point requested</span>
<span class="g g-Whitespace">    </span><span class="mi">352</span>     <span class="c1"># OR this is a recursive call to _masterFunc2 from a gradient evaluation that occured</span>
<span class="g g-Whitespace">    </span><span class="mi">353</span>     <span class="c1"># at the beginning of a hot started optimization</span>
<span class="g g-Whitespace">    </span><span class="mi">354</span>     <span class="n">timeA</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="ne">--&gt; </span><span class="mi">355</span>     <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">optProb</span><span class="o">.</span><span class="n">objFun</span><span class="p">(</span><span class="n">xuser</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">356</span>     <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">357</span>         <span class="n">funcs</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="nn">File /mnt/c/Users/John/Dropbox/git/openmdao/openmdao/utils/class_util.py:82,</span> in <span class="ni">WeakMethodWrapper.__call__</span><span class="nt">(self, *args, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">66</span> <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">67</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">68</span><span class="sd">     Call the named method on the object.</span>
<span class="g g-Whitespace">     </span><span class="mi">69</span><span class="sd"> </span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">     </span><span class="mi">80</span><span class="sd">         The return value of the wrapped method called with the given args.</span>
<span class="g g-Whitespace">     </span><span class="mi">81</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">---&gt; </span><span class="mi">82</span>     <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ref</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File /mnt/c/Users/John/Dropbox/git/openmdao/openmdao/drivers/pyoptsparse_driver.py:659,</span> in <span class="ni">pyOptSparseDriver._objfunc</span><span class="nt">(self, dv_dict)</span>
<span class="g g-Whitespace">    </span><span class="mi">657</span> <span class="k">try</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">658</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_in_user_function</span> <span class="o">=</span> <span class="kc">True</span>
<span class="ne">--&gt; </span><span class="mi">659</span>     <span class="n">model</span><span class="o">.</span><span class="n">run_solve_nonlinear</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">661</span> <span class="c1"># Let the optimizer try to handle the error</span>
<span class="g g-Whitespace">    </span><span class="mi">662</span> <span class="k">except</span> <span class="n">AnalysisError</span><span class="p">:</span>

<span class="nn">File /mnt/c/Users/John/Dropbox/git/openmdao/openmdao/core/system.py:4696,</span> in <span class="ni">System.run_solve_nonlinear</span><span class="nt">(self)</span>
<span class="g g-Whitespace">   </span><span class="mi">4690</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">4691</span><span class="sd"> Compute outputs.</span>
<span class="g g-Whitespace">   </span><span class="mi">4692</span><span class="sd"> </span>
<span class="g g-Whitespace">   </span><span class="mi">4693</span><span class="sd"> This calls _solve_nonlinear, but with the model assumed to be in an unscaled state.</span>
<span class="g g-Whitespace">   </span><span class="mi">4694</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">4695</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scaled_context_all</span><span class="p">():</span>
<span class="ne">-&gt; </span><span class="mi">4696</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_solve_nonlinear</span><span class="p">()</span>

<span class="nn">File /mnt/c/Users/John/Dropbox/git/openmdao/openmdao/core/group.py:2532,</span> in <span class="ni">Group._solve_nonlinear</span><span class="nt">(self)</span>
<span class="g g-Whitespace">   </span><span class="mi">2529</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathname</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathname</span> <span class="k">else</span> <span class="s1">&#39;root&#39;</span>
<span class="g g-Whitespace">   </span><span class="mi">2531</span> <span class="k">with</span> <span class="n">Recording</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;._solve_nonlinear&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_count</span><span class="p">,</span> <span class="bp">self</span><span class="p">):</span>
<span class="ne">-&gt; </span><span class="mi">2532</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_nonlinear_solver</span><span class="o">.</span><span class="n">_solve_with_cache_check</span><span class="p">()</span>

<span class="nn">File /mnt/c/Users/John/Dropbox/git/openmdao/openmdao/solvers/nonlinear/nonlinear_runonce.py:26,</span> in <span class="ni">NonlinearRunOnce._solve_with_cache_check</span><span class="nt">(self)</span>
<span class="g g-Whitespace">     </span><span class="mi">25</span> <span class="k">def</span> <span class="nf">_solve_with_cache_check</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="ne">---&gt; </span><span class="mi">26</span>     <span class="bp">self</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>

<span class="nn">File /mnt/c/Users/John/Dropbox/git/openmdao/openmdao/solvers/nonlinear/nonlinear_runonce.py:45,</span> in <span class="ni">NonlinearRunOnce.solve</span><span class="nt">(self)</span>
<span class="g g-Whitespace">     </span><span class="mi">41</span>             <span class="n">subsys</span><span class="o">.</span><span class="n">_solve_nonlinear</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">43</span> <span class="c1"># If this is not a parallel group, transfer for each subsystem just prior to running it.</span>
<span class="g g-Whitespace">     </span><span class="mi">44</span> <span class="k">else</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">45</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_gs_iter</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">47</span> <span class="n">rec</span><span class="o">.</span><span class="n">abs</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="g g-Whitespace">     </span><span class="mi">48</span> <span class="n">rec</span><span class="o">.</span><span class="n">rel</span> <span class="o">=</span> <span class="mf">0.0</span>

<span class="nn">File /mnt/c/Users/John/Dropbox/git/openmdao/openmdao/solvers/solver.py:800,</span> in <span class="ni">NonlinearSolver._gs_iter</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">798</span> <span class="k">if</span> <span class="n">subsys</span><span class="o">.</span><span class="n">_is_local</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">799</span>     <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">800</span>         <span class="n">subsys</span><span class="o">.</span><span class="n">_solve_nonlinear</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">801</span>     <span class="k">except</span> <span class="n">AnalysisError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">802</span>         <span class="k">if</span> <span class="s1">&#39;reraise_child_analysiserror&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="ow">or</span> \
<span class="g g-Whitespace">    </span><span class="mi">803</span>                 <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;reraise_child_analysiserror&#39;</span><span class="p">]:</span>

<span class="nn">File /mnt/c/Users/John/Dropbox/git/openmdao/openmdao/core/explicitcomponent.py:312,</span> in <span class="ni">ExplicitComponent._solve_nonlinear</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">310</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unscaled_context</span><span class="p">(</span><span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">],</span> <span class="n">residuals</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_residuals</span><span class="p">]):</span>
<span class="g g-Whitespace">    </span><span class="mi">311</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_residuals</span><span class="o">.</span><span class="n">set_val</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">312</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_compute_wrapper</span><span class="p">()</span>

<span class="nn">File /mnt/c/Users/John/Dropbox/git/openmdao/openmdao/core/explicitcomponent.py:286,</span> in <span class="ni">ExplicitComponent._compute_wrapper</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">283</span>     <span class="bp">self</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">284</span>                  <span class="bp">self</span><span class="o">.</span><span class="n">_discrete_inputs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_discrete_outputs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">285</span> <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">286</span>     <span class="bp">self</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_inputs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outputs</span><span class="p">)</span>

<span class="nn">Cell In[1], line 44,</span> in <span class="ni">FlightCase.compute</span><span class="nt">(self, inputs, outputs)</span>
<span class="g g-Whitespace">     </span><span class="mi">41</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">set_flight_vars</span><span class="p">(</span><span class="o">**</span><span class="n">inputs</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">42</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">set_geometry</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;x_aero&quot;</span><span class="p">])</span>
<span class="ne">---&gt; </span><span class="mi">44</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">46</span> <span class="n">funcs</span> <span class="o">=</span> <span class="p">{}</span>
<span class="g g-Whitespace">     </span><span class="mi">47</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">eval_functions</span><span class="p">(</span><span class="n">funcs</span><span class="p">)</span>

<span class="nn">File /mnt/c/Users/John/Dropbox/git/VSPAERO/vspaero/problems/base.py:283,</span> in <span class="ni">BaseProblem.solve</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">282</span> <span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">283</span>     <span class="bp">self</span><span class="o">.</span><span class="n">assembler</span><span class="o">.</span><span class="n">solve_forward</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">284</span>     <span class="bp">self</span><span class="o">.</span><span class="n">call_counter</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./aero"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="../intro.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Welcome to the TTT Garage!</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../aerostructural/aerostructural_example.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Aerostructural wing optimization using OpenAeroStruct</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By NASA Transformational Tools and Technologies Project<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>